<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recruitment Flow Form</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f7f5f4;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    min-height: 100vh;
  }

  .form-flow {
    width: 1400px;
    max-width: 1400px;
    background: #fff;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

  .form-flow h2 {
    background: #6a86dc;
    color: white;
    text-align: center;
    padding: 15px;
    border-radius: 10px;
    font-size: 1.5rem;
    margin: 0 0 20px 0;
  }

  .sections-container {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    align-items: start;
  }

  .section {
    border: 2px solid #000;
    border-radius: 10px;
    padding: 20px;
    background-color: #fafafa;
    height: fit-content;
  }

  .section h3 {
    margin-top: 0;
    font-size: 1rem;
    border-bottom: 2px solid #6a86dc;
    padding-bottom: 8px;
    margin-bottom: 15px;
    color: #333;
  }

  label {
    display: block;
    margin-top: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    color: #333;
  }

  input, select, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 0.9rem;
    box-sizing: border-box;
  }

  textarea {
    resize: vertical;
    min-height: 60px;
  }

  input:focus, select:focus, textarea:focus {
    outline: none;
    border: 2px solid #6a86dc;
    box-shadow: 0 0 5px rgba(106, 134, 220, 0.3);
  }

  input[readonly] {
    background-color: #f5f5f5;
    cursor: not-allowed;
  }

  /* Rich Text Editor Styles */
  .editor-wrapper {
    margin-top: 5px;
  }

  .editor-toolbar {
    background: #f0f0f0;
    border: 1px solid #ccc;
    border-bottom: none;
    border-radius: 6px 6px 0 0;
    padding: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
  }
  
  .editor-toolbar button {
    background: white;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: normal;
    transition: all 0.2s;
    min-width: 32px;
  }
  
  .editor-toolbar button:hover {
    background: #e0e0e0;
    transform: scale(1.05);
  }
  
  .editor-toolbar button:active {
    background: #d0d0d0;
  }

  .editor-toolbar button.active {
    background: #6a86dc;
    color: white;
    border-color: #6a86dc;
  }

  .editor-toolbar select {
    background: white;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 6px 8px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
    width: auto;
    margin: 0;
  }

  .editor-toolbar select:hover {
    background: #e0e0e0;
  }

  .editor-toolbar select:focus {
    outline: none;
    border-color: #6a86dc;
    box-shadow: 0 0 5px rgba(106, 134, 220, 0.3);
  }
  
  .editor-content {
    min-height: 200px;
    max-height: 400px;
    overflow-y: auto;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 0 0 6px 6px;
    background: white;
    font-size: 0.95rem;
    line-height: 1.6;
  }
  
  .editor-content:focus {
    outline: none;
    border-color: #6a86dc;
    box-shadow: 0 0 5px rgba(106, 134, 220, 0.3);
  }
  
  .editor-content ul, .editor-content ol {
    margin: 10px 0;
    padding-left: 30px;
  }
  
  .editor-content h1 {
    font-size: 1.8rem;
    margin: 15px 0 10px 0;
    color: #333;
  }
  
  .editor-content h2 {
    font-size: 1.4rem;
    margin: 12px 0 8px 0;
    background: none;
    color: #333;
    padding: 0;
    border-radius: 0;
  }
  
  .editor-content h3 {
    font-size: 1.2rem;
    margin: 10px 0 6px 0;
    color: #333;
    text-decoration: none;
    font-weight: bold;
  }

  .editor-content h1,
  .editor-content h2,
  .editor-content h3 {
    text-decoration: none;
  }

  .editor-content p {
    margin: 8px 0;
  }

  .button-container {
    grid-column: 1 / -1;
    text-align: center;
    margin-top: 20px;
  }

  button[type="submit"] {
    padding: 12px 40px;
    border: none;
    border-radius: 8px;
    background-color: #d86dd8;
    color: white;
    font-weight: bold;
    cursor: pointer;
    font-size: 1rem;
  }

  button[type="submit"]:hover {
    background-color: #b84bb8;
    transform: scale(1.05);
    transition: all 0.3s ease;
  }

  .success {
    background-color: #d4edda;
    color: #155724;
    padding: 12px;
    border-radius: 8px;
    margin-top: 20px;
    text-align: center;
    font-weight: bold;
    grid-column: 1 / -1;
  }

  .error {
    background-color: #f8d7da;
    color: #721c24;
    padding: 12px;
    border-radius: 8px;
    margin-top: 20px;
    text-align: center;
    font-weight: bold;
    grid-column: 1 / -1;
  }

  .hidden {
    display: none;
  }

  @media (max-width: 1200px) {
    .form-flow {
      width: 100%;
    }
    
    .sections-container {
      grid-template-columns: 1fr 1fr;
    }
  }

  @media (max-width: 768px) {
    .sections-container {
      grid-template-columns: 1fr;
    }

    .editor-toolbar {
      gap: 3px;
    }

    .editor-toolbar button {
      padding: 5px 8px;
      font-size: 12px;
    }
  }
</style>
</head>
<body>
  <form class="form-flow" id="recruitmentForm">
    <h2>OPEN POSITION</h2>

    <div class="sections-container">
      
      <div class="section">
        <h3>1. New Requirement</h3>
        
        <label>Division *</label>
        <select name="division" id="divisionSelect" required>
          <option value="">-- Select Division --</option>
          <option value="OTTO">OTTO</option>
          <option value="Minister White">Minister White</option>
          <option value="Otto Essentials">Otto Essentials</option>
        </select>

        <label>Department *</label>
        <input type="text" name="department" placeholder="Enter department name" required>

        <label>Position Title *</label>
        <input type="text" name="position" placeholder="Enter job title" required>

        <label>HR Department Email *</label>
        <input type="email" name="hr_email" id="hrEmail" placeholder="HR email will be auto-filled" required readonly>

        <label>CBO Email *</label>
        <input type="email" name="cbo_email" id="cboEmail" placeholder="CBO email will be auto-filled" required readonly>

        <label>Experience *</label>
        <input type="number" name="experience" placeholder="Number of Years Experience" min="0" required>

        <label>Salary Range *</label>
        <select name="salary" required>
          <option value="">-- Select Range --</option>
          <option value="1-3 lakh">1-3 lakh</option>
          <option value="4-5 lakh">4-5 lakh</option>
          <option value="5-7 lakh">5-7 lakh</option>
          <option value="7-10 lakh">7-10 lakh</option>
        </select>

        <label>Languages Required *</label>
        <input type="text" name="Languages" placeholder="Languages known" required>

        <label>Remarks</label>
        <textarea name="reason" placeholder="Remarks"></textarea>
      </div>

      <div class="section">
        <h3>2. JD Creation</h3>
        <label>Job Description *</label>
        
        <!-- Rich Text Editor -->
        <div class="editor-wrapper">
          <div class="editor-toolbar">
            <button type="button" onclick="formatText('undo')" title="Undo">↶ Undo</button>
            <button type="button" onclick="formatText('redo')" title="Redo">↷ Redo</button>
            <button type="button" onclick="formatText('bold')" title="Bold"><b>B</b></button>
            <button type="button" onclick="formatText('italic')" title="Italic"><i>I</i></button>
            <button type="button" onclick="formatText('underline')" title="Underline"><u>U</u></button>
            <select onchange="changeFontSize(this.value)" title="Font Size">
              <option value="">Size</option>
              <option value="1">Small</option>
              <option value="3">Normal</option>
              <option value="5">Large</option>
              <option value="7">Huge</option>
            </select>
            <button type="button" onclick="formatText('formatBlock', '<p>')" title="Normal Text">Normal</button>
            <button type="button" onclick="formatText('formatBlock', '<h1>')" title="Heading 1">H1</button>
            <button type="button" onclick="formatText('formatBlock', '<h2>')" title="Heading 2">H2</button>
            <button type="button" onclick="formatText('formatBlock', '<h3>')" title="Heading 3">H3</button>
            <button type="button" onclick="formatText('justifyLeft')" title="Align Left">⬅</button>
            <button type="button" onclick="formatText('justifyCenter')" title="Align Center">↔</button>
            <button type="button" onclick="formatText('justifyRight')" title="Align Right">➡</button>
            <button type="button" onclick="formatText('justifyFull')" title="Justify">⬌</button>
            <button type="button" onclick="formatText('insertUnorderedList')" title="Bullet List">• List</button>
            <button type="button" onclick="formatText('insertOrderedList')" title="Numbered List">1. List</button>
            <button type="button" onclick="clearFormatting()" title="Clear All Formatting">Clear Format</button>
            <button type="button" onclick="clearAllContent()" title="Clear All Content" style="background: #ffebee; color: #c62828;">Clear All</button>
          </div>
          <div 
            id="jdEditor" 
            class="editor-content" 
            contenteditable="true" 
            data-placeholder="Write or paste job description here..."
          ></div>
        </div>
        
        <!-- Hidden input to store HTML content -->
        <input type="hidden" name="jd" id="jdInput" required>

        <label>Required Skills *</label>
        <input type="text" name="skills" placeholder="e.g. Networking, React.js, SQL" required>
      </div>

      <div class="section">
        <h3>3. Replacement</h3>

        <label>Number Of Vacancy *</label>
        <input type="number" name="numberofvacancy" placeholder="Enter Number Of Vacancy" min="1" required>

        <label>Is this a replacement for an existing employee? *</label>
        <select name="replacement" id="replacementSelect" required>
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

        <div id="replacementYesFields" class="hidden">
          <label>Employee Name *</label>
          <input type="text" id="employeeName" placeholder="Enter previous employee name">
        </div>

        <div id="replacementNoFields" class="hidden">
          <label>Reason for Hiring *</label>
          <textarea id="hiringReason" placeholder="Explain the reason for this new hire" style="min-height: 80px;"></textarea>
        </div>
      </div>

      <div class="button-container">
        <button type="submit">Submit Form</button>
      </div>

      <div id="responseMsg"></div>

    </div>
  </form>

  <script>
    const form = document.getElementById("recruitmentForm");
    const responseMsg = document.getElementById("responseMsg");
    const replacementSelect = document.getElementById("replacementSelect");
    const replacementYesFields = document.getElementById("replacementYesFields");
    const replacementNoFields = document.getElementById("replacementNoFields");
    const employeeName = document.getElementById("employeeName");
    const hiringReason = document.getElementById("hiringReason");
    const jdEditor = document.getElementById("jdEditor");
    const jdInput = document.getElementById("jdInput");
    const divisionSelect = document.getElementById("divisionSelect");
    const hrEmail = document.getElementById("hrEmail");
    const cboEmail = document.getElementById("cboEmail");

    // Division email mappings
    const divisionEmails = {
      "OTTO": {
        hr: "abinaya@ottoclothing.in, gajalakshmib@ottoclothing.in",
        cbo: "varshapothy@ottostore.com"
      },
      "Minister White": {
        hr: "sugas@ministerwhite.com, gajalakshmib@ottoclothing.in",
        cbo: "suresh@ministerwhite.com"
      },
      "Otto Essentials": {
        hr: "abinaya@ottoclothing.in, gajalakshmib@ottoclothing.in",
        cbo: "praveen@ottoclothing.in"
      }
    };

    // Handle division selection
    divisionSelect.addEventListener("change", function() {
      const selectedDivision = this.value;
      
      if (selectedDivision && divisionEmails[selectedDivision]) {
        hrEmail.value = divisionEmails[selectedDivision].hr;
        cboEmail.value = divisionEmails[selectedDivision].cbo;
        hrEmail.style.backgroundColor = "#e8f5e9";
        cboEmail.style.backgroundColor = "#e8f5e9";
      } else {
        hrEmail.value = "";
        cboEmail.value = "";
        hrEmail.style.backgroundColor = "";
        cboEmail.style.backgroundColor = "";
      }
    });

    // Rich Text Editor Functions
    function formatText(command, value = null) {
      // Prevent default button behavior
      event.preventDefault();
      
      // Focus the editor
      jdEditor.focus();
      
      // Execute the formatting command
      if (value) {
        document.execCommand(command, false, value);
      } else {
        document.execCommand(command, false, null);
      }
      
      // Update hidden input
      updateHiddenInput();
    }

    // Change font size
    function changeFontSize(size) {
      if (size) {
        jdEditor.focus();
        document.execCommand('fontSize', false, size);
        updateHiddenInput();
      }
      // Reset dropdown
      event.target.value = '';
    }

    // Clear all content from editor
    function clearAllContent() {
      event.preventDefault();
      if (confirm('Are you sure you want to clear all content?')) {
        jdEditor.innerHTML = '';
        jdInput.value = '';
        jdEditor.setAttribute('data-placeholder', 'Write or paste job description here...');
        jdEditor.focus();
      }
    }

    // Clear all formatting from selected text
    function clearFormatting() {
      event.preventDefault();
      jdEditor.focus();
      
      // Get selection
      const selection = window.getSelection();
      
      if (selection.rangeCount > 0) {
        // First remove inline formatting
        document.execCommand('removeFormat', false, null);
        
        // Then convert any heading back to paragraph
        document.execCommand('formatBlock', false, '<p>');
        
        // Remove font size
        document.execCommand('fontSize', false, '3');
        
        // Remove alignment
        document.execCommand('justifyLeft', false, null);
      }
      
      updateHiddenInput();
    }

    // Update hidden input with editor content
    function updateHiddenInput() {
      jdInput.value = jdEditor.innerHTML;
    }

    // Update hidden input when content changes
    jdEditor.addEventListener('input', updateHiddenInput);
    jdEditor.addEventListener('blur', updateHiddenInput);

    // Add placeholder behavior
    jdEditor.addEventListener('focus', function() {
      if (this.innerHTML.trim() === '') {
        this.innerHTML = '';
      }
    });

    jdEditor.addEventListener('blur', function() {
      if (this.innerHTML.trim() === '') {
        this.setAttribute('data-placeholder', 'Write or paste job description here...');
      } else {
        this.removeAttribute('data-placeholder');
      }
    });

    // Add CSS for placeholder
    const style = document.createElement('style');
    style.innerHTML = `
      .editor-content[data-placeholder]:empty:before {
        content: attr(data-placeholder);
        color: #999;
        font-style: italic;
      }
    `;
    document.head.appendChild(style);

    // Show/hide fields based on replacement selection
    replacementSelect.addEventListener("change", function() {
      const value = this.value;
      
      if (value === "Yes") {
        replacementYesFields.classList.remove("hidden");
        replacementNoFields.classList.add("hidden");
        employeeName.required = true;
        hiringReason.required = false;
        hiringReason.value = "";
      } else if (value === "No") {
        replacementYesFields.classList.add("hidden");
        replacementNoFields.classList.remove("hidden");
        employeeName.required = false;
        employeeName.value = "";
        hiringReason.required = true;
      } else {
        replacementYesFields.classList.add("hidden");
        replacementNoFields.classList.add("hidden");
        employeeName.required = false;
        hiringReason.required = false;
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Validate JD content
      if (jdEditor.innerHTML.trim() === '' || jdEditor.innerHTML.trim() === '<br>') {
        responseMsg.innerHTML = `<div class="error">❌ Please enter a job description</div>`;
        jdEditor.focus();
        return;
      }

      const formData = new FormData(form);
      const data = {};
      
      // Build data object from form
      formData.forEach((value, key) => {
        data[key] = value;
      });

      // Handle conditional fields based on replacement value
      if (data.replacement === "Yes") {
        const empName = document.getElementById("employeeName").value;
        if (!empName || empName.trim() === "") {
          responseMsg.innerHTML = `<div class="error">❌ Please enter employee name for replacement</div>`;
          return;
        }
        data.employee_name = empName.trim();
        // Ensure hiring_reason is not included
        delete data.hiring_reason;
      } else if (data.replacement === "No") {
        const reason = document.getElementById("hiringReason").value;
        if (!reason || reason.trim() === "") {
          responseMsg.innerHTML = `<div class="error">❌ Please provide reason for hiring</div>`;
          return;
        }
        data.hiring_reason = reason.trim();
        // Ensure employee_name is not included
        delete data.employee_name;
      }

      console.log("Form data:", data);
      console.log("JD HTML:", data.jd);

      try {
        // REPLACE '#' WITH YOUR ACTUAL WEBHOOK URL
        const res = await fetch("#", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        if (res.ok) {
          responseMsg.innerHTML = `<div class="success">✅ Form submitted successfully!</div>`;
          form.reset();
          jdEditor.innerHTML = '';
          jdEditor.setAttribute('data-placeholder', 'Write or paste job description here...');
          document.getElementById("employeeName").value = "";
          document.getElementById("hiringReason").value = "";
          replacementYesFields.classList.add("hidden");
          replacementNoFields.classList.add("hidden");
        } else {
          responseMsg.innerHTML = `<div class="error">❌ Submission failed. Please try again.</div>`;
        }
      } catch (err) {
        responseMsg.innerHTML = `<div class="error">⚠️ Error: ${err.message}</div>`;
      }
    });
  </script>
</body>
</html>